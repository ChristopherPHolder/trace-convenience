<div class="file-upload-container">
  @if (!hasFiles()) {
    <div
      class="drop-zone"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
      role="region"
      aria-label="File upload drop zone"
    >
      <div class="drop-zone-content">
        @if (isDragging()) {
          <div class="drag-active" aria-live="polite">
            <svg
              class="icon icon-large"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
              />
            </svg>
            <p class="text-large">Drop your JSON file here</p>
          </div>
        } @else {
          <div class="drop-zone-idle">
            <svg
              class="icon icon-large"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
              />
            </svg>
            <p class="text-large">Drag and drop a JSON file here</p>
            <p class="text-small">or</p>
            <label class="file-input-label">
              <input
                type="file"
                class="file-input"
                accept=".json,application/json"
                (change)="onFileSelect($event)"
                aria-label="Select a JSON file to upload"
              />
              <span class="btn btn-primary">Browse Files</span>
            </label>
            <p class="text-hint">Only JSON files are accepted</p>
          </div>
        }

        @if (isProcessing()) {
          <div class="processing-indicator" role="status" aria-live="polite">
            <span class="spinner" aria-hidden="true"></span>
            <span>Processing file...</span>
          </div>
        }
      </div>
    </div>

    @if (errors().length > 0) {
      <div class="error-list" role="alert" aria-live="assertive">
        <h3 class="error-title">Upload Error</h3>
        <ul>
          @for (error of errors(); track error.fileName) {
            <li class="error-item">
              <svg
                class="icon icon-small"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                  clip-rule="evenodd"
                />
              </svg>
              <strong>{{ error.fileName }}:</strong> {{ error.message }}
            </li>
          }
        </ul>
      </div>
    }
  }

  @if (hasFiles()) {
    <div class="file-widget">
      <div class="widget-header">
        <svg
          class="icon icon-medium"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 20 20"
          fill="currentColor"
          aria-hidden="true"
        >
          <path
            fill-rule="evenodd"
            d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"
            clip-rule="evenodd"
          />
        </svg>
        <h3 class="widget-title">Uploaded File</h3>
        <button
          type="button"
          class="btn btn-icon"
          (click)="onRemoveFile(uploadedFiles()[0].id)"
          aria-label="Remove file and upload a new one"
          title="Remove file"
        >
          <svg
            class="icon icon-small"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
      </div>
      <div class="widget-content">
        <div class="file-details">
          <p class="file-name">{{ uploadedFiles()[0].name }}</p>
          <p class="file-meta">
            {{ formatFileSize(uploadedFiles()[0].size) }} â€¢
            {{ formatDate(uploadedFiles()[0].uploadedAt) }}
          </p>
        </div>
        <div class="widget-status">
          <svg
            class="icon icon-small success-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
              clip-rule="evenodd"
            />
          </svg>
          <span class="status-text">Ready</span>
        </div>
      </div>
    </div>

    <!-- Film Strip Component -->
    <app-film-strip
      [screenshots]="screenshots()"
      [startTime]="traceStartTime()"
      [endTime]="traceEndTime()"
    />
  }
</div>

